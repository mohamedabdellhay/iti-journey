{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///home/mohamedabdellhay/work/iti/ai/app/api/chat/route.ts"],"sourcesContent":["import OpenAI from \"openai\"\n\nconst client = new OpenAI({ apiKey: process.env.OPENAI_API_KEY })\n\nexport async function POST(req: Request) {\n  try {\n    const { messages } = await req.json()\n\n    // التحقق من وجود الرسائل\n    if (!messages || !Array.isArray(messages) || messages.length === 0) {\n      return new Response(\n        JSON.stringify({ error: \"Messages array is required\" }),\n        { status: 400, headers: { \"Content-Type\": \"application/json\" } }\n      )\n    }\n\n    // تحويل الرسائل للـ OpenAI format\n    const chatMessages = messages.map((m: any) => ({\n      role: m.role,\n      content: m.parts.map((p: any) => p.text).join(\"\"),\n    }))\n\n    // طلب الرد من OpenAI\n    const response = await client.chat.completions.create({\n      model: \"gpt-4o-mini\",\n      messages: chatMessages,\n    })\n\n    const assistantMessage = response.choices[0].message\n\n    // رجع كل الرسائل + الرد\n    return new Response(\n      JSON.stringify([\n        ...messages,\n        {\n          id: crypto.randomUUID(), // استخدم UUID بدل ID من OpenAI\n          role: assistantMessage.role,\n          parts: [{ type: \"text\", text: assistantMessage.content }],\n        },\n      ]),\n      {\n        status: 200,\n        headers: { \"Content-Type\": \"application/json\" },\n      }\n    )\n  } catch (error: any) {\n    console.error(\"OpenAI API Error:\", error)\n    \n    return new Response(\n      JSON.stringify({ \n        error: \"Failed to process chat request\",\n        details: error.message \n      }),\n      { \n        status: 500, \n        headers: { \"Content-Type\": \"application/json\" } \n      }\n    )\n  }\n}"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEA,MAAM,SAAS,IAAI,yLAAM,CAAC;IAAE,QAAQ,QAAQ,GAAG,CAAC,cAAc;AAAC;AAExD,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAEnC,yBAAyB;QACzB,IAAI,CAAC,YAAY,CAAC,MAAM,OAAO,CAAC,aAAa,SAAS,MAAM,KAAK,GAAG;YAClE,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA6B,IACrD;gBAAE,QAAQ;gBAAK,SAAS;oBAAE,gBAAgB;gBAAmB;YAAE;QAEnE;QAEA,kCAAkC;QAClC,MAAM,eAAe,SAAS,GAAG,CAAC,CAAC,IAAW,CAAC;gBAC7C,MAAM,EAAE,IAAI;gBACZ,SAAS,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC,IAAW,EAAE,IAAI,EAAE,IAAI,CAAC;YAChD,CAAC;QAED,qBAAqB;QACrB,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpD,OAAO;YACP,UAAU;QACZ;QAEA,MAAM,mBAAmB,SAAS,OAAO,CAAC,EAAE,CAAC,OAAO;QAEpD,wBAAwB;QACxB,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;eACV;YACH;gBACE,IAAI,OAAO,UAAU;gBACrB,MAAM,iBAAiB,IAAI;gBAC3B,OAAO;oBAAC;wBAAE,MAAM;wBAAQ,MAAM,iBAAiB,OAAO;oBAAC;iBAAE;YAC3D;SACD,GACD;YACE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IAEJ,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,qBAAqB;QAEnC,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;YACb,OAAO;YACP,SAAS,MAAM,OAAO;QACxB,IACA;YACE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IAEJ;AACF"}}]
}